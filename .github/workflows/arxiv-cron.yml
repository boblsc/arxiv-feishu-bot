name: Weekly arXiv push to Feishu (classification)

on:
  schedule:
    # 每周一 01:00 UTC 触发（≈ 北京时间 09:00，洛杉矶前一天下午）
    - cron: '0 1 * * 1'
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        keyword: ${{ fromJson(vars.ARXIV_KEYWORDS_JSON || '["dark matter","neutrino","TPC","xenon","argon","WIMP","CEvNS"]') }}
    env:
      ARXIV_CLASSES: ${{ secrets.ARXIV_CLASSES }}
      REQUIRE_PHYSICS_GROUP: "1"
      RESULT_SIZE: "200"
      ORDER: "-announced_date_first"
      HIDE_ABSTRACTS: "False"
      TOP_SEND: "0"
      ANNOUNCEMENT_WINDOW_DAYS: "7"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Push to Feishu
        env:
          WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
          ARXIV_QUERY: ${{ matrix.keyword }}
        run: |
          python arxiv_to_feishu.py
