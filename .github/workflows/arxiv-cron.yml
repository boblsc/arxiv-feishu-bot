name: Daily arXiv push to Feishu (classification)

on:
  schedule:
    # 每天 16:00 UTC 触发（≈ 洛杉矶早上 09:00，夏令时期间）
    - cron: '0 1 * * *'
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      - name: Push to Feishu
        env:
          WEBHOOK_URL:        ${{ secrets.FEISHU_WEBHOOK_URL }}
          ARXIV_QUERY:        ${{ secrets.ARXIV_QUERY }}          # 你的关键词集合
          ARXIV_CLASSES:      ${{ secrets.ARXIV_CLASSES }}        # 例如：hep-th,hep-ex,hep-ph,nucl-ex,physics.ins-det
        
          REQUIRE_PHYSICS_GROUP: "1"
          RESULT_SIZE: "50"
          ORDER: "-announced_date_first"
        
          # 关键：要摘要 + 只当天
          HIDE_ABSTRACTS: "False"
          TODAY_ONLY: "1"
          LOCAL_TZ: "America/Los_Angeles"
        
          TOP_SEND: "10"
          DAYS: "0"   # TODAY_ONLY 已经满足当天，这里保持 0
        run: |
          python arxiv_to_feishu.py
